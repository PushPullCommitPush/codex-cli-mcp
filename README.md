# codex-cli-mcp

Stdio MCP server that wraps the local Codex CLI and pulls model profiles dynamically from OpenWebUI (`openwebui-data/webui.db`). Supports hybrid multi-model delegation plus an isolated security profile.

## Requirements
- Node.js
- Codex CLI installed and accessible at `/opt/homebrew/bin/codex` (or set `CODEX_PATH`)
- `sqlite3` CLI available (used to read OpenWebUI DB)

## Install / Run
```bash
cd codex-cli-mcp
npm install  # no deps
node index.js --workdir /path/to/workdir   # default: ~/codex-work
```
Use `./index.js` directly if executable bits are set.

## Profiles (auto-synced)
- Models are read from `openwebui-data/webui.db` (`SELECT id,name,base_model_id FROM model`). Fallback list is baked in.
- Standard profiles map 1:1 to OpenWebUI model IDs; legacy aliases: `fast`→oss20b, `heavy`→oss120b, `reasoning`→deepseek, `coder`→qwen-coder, `kimi/security`→security.
- `default` profile targets `codex-max` with high reasoning; non-security profiles run with `--dangerously-bypass-approvals-and-sandbox` to avoid macOS sandbox blocks. `security` uses an isolated CODEX_HOME at `profiles/security/` with `approval_policy=untrusted` and `sandbox=workspace-write`.
- Config files (`config.toml`, `profiles/security/config.toml`) are autogenerated each call; edits will be overwritten.

## Tools
- `codex_run` — prompt + optional `profile`, `model`, `timeout`.
- `codex_resume` — resume last session with optional `profile`.
- `codex_profiles` — list current profiles and source (OpenWebUI or fallback).
- `fs_read` / `fs_write` / `fs_list` — operate only inside `workdir`.

Outputs include trimmed stdout/stderr; processes are auto-killed after the provided timeout (default 300s).

## Auth
This MCP sanitizes `CODEX_HOME`; log in once per home:
```bash
cd /path/to/codex-cli-mcp
CODEX_HOME=$(pwd) codex login
# security profile (isolated):
cd /path/to/codex-cli-mcp/profiles/security
CODEX_HOME=$(pwd) codex login
```

## Notes
- Paths are sandboxed to the configured workdir; traversal outside is rejected.
- Configure `OPENWEBUI_DB` to point elsewhere if your DB lives in another path.
